<div class="main-container">
        <!-- Overlay de carga -->
        <div *ngIf="isLoading" class="loading-overlay">
            <p>Procesando la agenda...</p>
        </div>
        
        <div class="agenda-card">
            <h2 class="agenda-titulo">Gestión de Agenda</h2>
            <p class="agenda-subtitulo">Define los días y rangos horarios en los que estarás disponible para atender.</p>

            <div class="schedule-header">
                <p class="schedule-info">
                    Gestionando horarios para el: 
                    <strong>{{ fechaSeleccionada | date: 'fullDate' }}</strong>
                    <span *ngIf="esHoy(fechaSeleccionada)" class="tag-hoy"> (HOY)</span>
                </p>
                
                <mat-form-field appearance="outline" class="date-picker-field">
                    <mat-label>Seleccionar Día</mat-label>
                    <!-- El minDate es para evitar seleccionar días pasados -->
                    <input matInput [matDatepicker]="picker" 
                           [min]="minDate"
                           [value]="fechaSeleccionada"
                           (dateChange)="onDateChange($event)"
                           placeholder="Día de la Agenda"
                           [disabled]="isLoading">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
            </div>
            
            <h3 class="seccion-titulo">Horarios Cargados ({{ rangosDelDia.length }})</h3>

            <div class="rangos-list">
                <div *ngIf="rangosDelDia.length === 0" class="rangos-vacio">
                    <mat-icon>schedule</mat-icon>
                    <p>No hay horarios de atención definidos para este día.</p>
                </div>
                
                <div *ngFor="let rango of rangosDelDia" class="rango-item cargado">
                    <span class="rango-texto">
                        {{ rango.horaInicio }} hrs — {{ rango.horaFin }} hrs
                    </span>
                </div>
            </div>

            <h3 class="seccion-titulo nuevo-rango">Agregar Nuevos Rangos</h3>
            
            <button mat-raised-button color="accent" (click)="agregarNuevoRango()" class="agregar-btn" [disabled]="isLoading">
                <mat-icon>add</mat-icon>
                Agregar Nuevo Rango
            </button>

            <div class="nuevos-rangos-group" *ngIf="rangosNuevos.length > 0">
                <div *ngFor="let rango of rangosNuevos; let i = index" class="nuevo-rango-form">
                    
                    <mat-form-field appearance="outline" class="hora-input">
                        <mat-label>Hora Inicio</mat-label>
                        <input matInput type="time" 
                               required 
                               [(ngModel)]="rango.horaInicio" 
                               (ngModelChange)="validarRango(rango)"
                               [ngModelOptions]="{standalone: true}"
                               [disabled]="isLoading">
                    </mat-form-field>

                    <span class="separador">a</span>

                    <mat-form-field appearance="outline" class="hora-input">
                        <mat-label>Hora Fin</mat-label>
                        <input matInput type="time" 
                               required 
                               [(ngModel)]="rango.horaFin"
                               (ngModelChange)="validarRango(rango)"
                               [ngModelOptions]="{standalone: true}"
                               [disabled]="isLoading">
                        <!-- Mensaje de error ajustado -->
                        <mat-error *ngIf="rango.horaFin.length > 0 && rango.horaFin <= rango.horaInicio">
                            La hora fin debe ser posterior a la de inicio.
                        </mat-error>
                    </mat-form-field>
                    
                    <mat-icon *ngIf="rango.isValid" class="check-valid" matTooltip="Rango Válido">check_circle</mat-icon>
                </div>
            </div>

            <div class="form-actions">
                <button mat-raised-button 
                        color="primary" 
                        [disabled]="!puedeGuardar || isLoading"
                        (click)="guardarAgenda()">
                    <mat-icon>save</mat-icon>
                    Guardar Agenda
                </button>
            </div>
            
        </div>
    </div>